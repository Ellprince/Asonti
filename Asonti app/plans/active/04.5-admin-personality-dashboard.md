# Plan 04.5: Admin Personality Dashboard

## Overview
**Status:** Planned (After Plan 04)  
**Priority:** Medium  
**Duration:** 1 day (8 hours)  
**Dependencies:** Plan 04 (AI Personality Analysis) must be complete  
**Created:** 2025-01-28  

## Objective
Create a comprehensive admin dashboard that allows the superadmin to view all user personality analyses, wizard responses, engagement metrics, and aggregate insights. This dashboard will be hidden from regular users and provide full visibility into the AI personality system.

## Context
After implementing the hidden personality analysis (Plan 04), we need a way for the admin to:
- Monitor the personality analysis results
- View complete wizard responses from all users
- Track engagement and effectiveness
- Export data for analysis
- Ensure quality control of AI interactions

This dashboard is essential for understanding how users interact with the AI and optimizing the experience.

## Success Criteria
- [ ] Secure admin-only access implemented
- [ ] View all users' personality scores in table format
- [ ] Display individual user wizard responses
- [ ] Show engagement metrics and analytics
- [ ] Export functionality for data analysis
- [ ] Mobile-responsive admin interface
- [ ] Real-time data updates
- [ ] Search and filter capabilities

## Technical Architecture

### Access Control
```typescript
// Option 1: Role-based (Recommended)
// Add to user_metadata in Supabase
{
  "role": "superadmin",
  "admin_since": "2025-01-28"
}

// Option 2: Environment-based
// Check against ADMIN_EMAILS env variable
const ADMIN_EMAILS = ['founder@asonti.ai']
```

### Route Structure
```
/admin (redirects to login if not authenticated)
├── /admin/dashboard (overview stats)
├── /admin/users (user list with filters)
├── /admin/users/:id (individual user details)
├── /admin/personality (personality analysis view)
├── /admin/analytics (aggregate insights)
└── /admin/exports (data export tools)
```

## Implementation Plan

### Phase 1: Admin Authentication (1 hour)

#### 1.1 Admin Middleware
**File:** `src/middleware/adminAuth.ts`

```typescript
export const requireAdmin = async (userId: string): Promise<boolean> => {
  const { data: user } = await supabase
    .from('users')
    .select('role')
    .eq('id', userId)
    .single()
  
  return user?.role === 'superadmin'
}

export const AdminRoute = ({ children }) => {
  const [isAdmin, setIsAdmin] = useState(false)
  const [loading, setLoading] = useState(true)
  
  useEffect(() => {
    checkAdminStatus()
  }, [])
  
  if (loading) return <Spinner />
  if (!isAdmin) return <Navigate to="/" />
  
  return children
}
```

### Phase 2: Dashboard Overview (2 hours)

#### 2.1 Main Dashboard Component
**File:** `src/components/admin/AdminDashboard.tsx`

```typescript
const AdminDashboard = () => {
  const [stats, setStats] = useState({
    totalUsers: 0,
    analyzedProfiles: 0,
    activeToday: 0,
    avgEngagement: 0,
    totalMessages: 0,
  })
  
  return (
    <div className="min-h-screen bg-gray-50">
      {/* Admin Header */}
      <header className="bg-white shadow-sm border-b">
        <div className="px-6 py-4">
          <h1 className="text-2xl font-bold">ASONTI Admin Dashboard</h1>
          <p className="text-gray-600">Personality Analysis & User Insights</p>
        </div>
      </header>
      
      {/* Stats Grid */}
      <div className="p-6">
        <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
          <StatCard
            title="Total Users"
            value={stats.totalUsers}
            icon={Users}
            trend="+12%"
          />
          <StatCard
            title="Analyzed Profiles"
            value={stats.analyzedProfiles}
            percentage={stats.analyzedProfiles / stats.totalUsers * 100}
          />
          <StatCard
            title="Active Today"
            value={stats.activeToday}
            icon={Activity}
          />
          <StatCard
            title="Avg Engagement"
            value={`${stats.avgEngagement} min`}
            icon={Clock}
          />
          <StatCard
            title="Total Messages"
            value={stats.totalMessages}
            icon={MessageSquare}
          />
        </div>
      </div>
      
      {/* Quick Actions */}
      <div className="px-6">
        <div className="bg-white rounded-lg shadow p-4">
          <h2 className="font-semibold mb-3">Quick Actions</h2>
          <div className="flex gap-2">
            <Button onClick={() => navigate('/admin/users')}>
              View All Users
            </Button>
            <Button onClick={() => navigate('/admin/exports')}>
              Export Data
            </Button>
            <Button onClick={refreshAnalytics}>
              Refresh Analytics
            </Button>
          </div>
        </div>
      </div>
    </div>
  )
}
```

### Phase 3: User List with Personality Scores (2 hours)

#### 3.1 User Table Component
**File:** `src/components/admin/UserPersonalityTable.tsx`

```typescript
const UserPersonalityTable = () => {
  const [users, setUsers] = useState([])
  const [sortBy, setSortBy] = useState('created_at')
  const [filterBy, setFilterBy] = useState('all')
  const [searchTerm, setSearchTerm] = useState('')
  
  return (
    <div className="p-6">
      {/* Search and Filters */}
      <div className="bg-white rounded-lg shadow p-4 mb-4">
        <div className="flex gap-4">
          <Input
            placeholder="Search users..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="flex-1"
          />
          <Select value={filterBy} onValueChange={setFilterBy}>
            <SelectTrigger className="w-48">
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">All Users</SelectItem>
              <SelectItem value="analyzed">Analyzed Only</SelectItem>
              <SelectItem value="active_week">Active This Week</SelectItem>
              <SelectItem value="inactive">Inactive</SelectItem>
            </SelectContent>
          </Select>
          <Button variant="outline" onClick={exportToCSV}>
            Export CSV
          </Button>
        </div>
      </div>
      
      {/* User Table */}
      <div className="bg-white rounded-lg shadow overflow-hidden">
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>User</TableHead>
              <TableHead>Joined</TableHead>
              <TableHead className="text-center">O</TableHead>
              <TableHead className="text-center">C</TableHead>
              <TableHead className="text-center">E</TableHead>
              <TableHead className="text-center">A</TableHead>
              <TableHead className="text-center">N</TableHead>
              <TableHead>Style</TableHead>
              <TableHead>Messages</TableHead>
              <TableHead>Last Active</TableHead>
              <TableHead>Actions</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {users.map(user => (
              <TableRow key={user.id}>
                <TableCell>
                  <div>
                    <p className="font-medium">{user.name}</p>
                    <p className="text-sm text-gray-500">{user.email}</p>
                  </div>
                </TableCell>
                <TableCell>{formatDate(user.created_at)}</TableCell>
                <TableCell className="text-center">
                  <Badge variant={getScoreBadgeVariant(user.personality?.bigFive.openness)}>
                    {user.personality?.bigFive.openness || '-'}
                  </Badge>
                </TableCell>
                <TableCell className="text-center">
                  <Badge variant={getScoreBadgeVariant(user.personality?.bigFive.conscientiousness)}>
                    {user.personality?.bigFive.conscientiousness || '-'}
                  </Badge>
                </TableCell>
                <TableCell className="text-center">
                  <Badge variant={getScoreBadgeVariant(user.personality?.bigFive.extraversion)}>
                    {user.personality?.bigFive.extraversion || '-'}
                  </Badge>
                </TableCell>
                <TableCell className="text-center">
                  <Badge variant={getScoreBadgeVariant(user.personality?.bigFive.agreeableness)}>
                    {user.personality?.bigFive.agreeableness || '-'}
                  </Badge>
                </TableCell>
                <TableCell className="text-center">
                  <Badge variant={getScoreBadgeVariant(user.personality?.bigFive.neuroticism)}>
                    {user.personality?.bigFive.neuroticism || '-'}
                  </Badge>
                </TableCell>
                <TableCell>
                  <Badge variant="outline">
                    {user.personality?.communicationStyle.preferred || 'Not analyzed'}
                  </Badge>
                </TableCell>
                <TableCell>{user.message_count}</TableCell>
                <TableCell>{formatRelativeTime(user.last_active)}</TableCell>
                <TableCell>
                  <Button
                    size="sm"
                    variant="ghost"
                    onClick={() => navigate(`/admin/users/${user.id}`)}
                  >
                    View Details
                  </Button>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </div>
    </div>
  )
}
```

### Phase 4: Individual User Details (2 hours)

#### 4.1 User Detail View
**File:** `src/components/admin/UserDetailView.tsx`

```typescript
const UserDetailView = ({ userId }: { userId: string }) => {
  const [userData, setUserData] = useState(null)
  const [activeTab, setActiveTab] = useState('wizard')
  
  return (
    <div className="p-6 max-w-7xl mx-auto">
      {/* User Header */}
      <div className="bg-white rounded-lg shadow p-6 mb-6">
        <div className="flex items-center gap-4">
          <Avatar className="h-20 w-20">
            <AvatarImage src={userData?.avatar_url} />
            <AvatarFallback>{userData?.name?.charAt(0)}</AvatarFallback>
          </Avatar>
          <div className="flex-1">
            <h2 className="text-2xl font-bold">{userData?.name}</h2>
            <p className="text-gray-600">{userData?.email}</p>
            <div className="flex gap-4 mt-2">
              <Badge>Joined {formatDate(userData?.created_at)}</Badge>
              <Badge variant="outline">
                {userData?.message_count} messages
              </Badge>
            </div>
          </div>
          <Button variant="outline" onClick={() => exportUserData(userId)}>
            Export User Data
          </Button>
        </div>
      </div>
      
      {/* Tabs */}
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList className="grid w-full grid-cols-5">
          <TabsTrigger value="wizard">Wizard Responses</TabsTrigger>
          <TabsTrigger value="personality">Personality</TabsTrigger>
          <TabsTrigger value="chat">Chat History</TabsTrigger>
          <TabsTrigger value="analytics">Analytics</TabsTrigger>
          <TabsTrigger value="actions">Actions</TabsTrigger>
        </TabsList>
        
        {/* Wizard Responses Tab */}
        <TabsContent value="wizard">
          <Card>
            <CardHeader>
              <CardTitle>Wizard Responses</CardTitle>
            </CardHeader>
            <CardContent className="space-y-6">
              {/* Attributes */}
              <div>
                <h4 className="font-semibold mb-2">Character Attributes</h4>
                <div className="grid grid-cols-3 gap-4">
                  <div>
                    <Label>Have Now</Label>
                    <div className="flex flex-wrap gap-1 mt-1">
                      {userData?.wizard.attributes.have_now.map(attr => (
                        <Badge key={attr} variant="default">{attr}</Badge>
                      ))}
                    </div>
                  </div>
                  <div>
                    <Label>Want to Develop</Label>
                    <div className="flex flex-wrap gap-1 mt-1">
                      {userData?.wizard.attributes.want_to_develop.map(attr => (
                        <Badge key={attr} variant="secondary">{attr}</Badge>
                      ))}
                    </div>
                  </div>
                  <div>
                    <Label>Not Me</Label>
                    <div className="flex flex-wrap gap-1 mt-1">
                      {userData?.wizard.attributes.not_me.map(attr => (
                        <Badge key={attr} variant="outline">{attr}</Badge>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
              
              {/* Hopes & Fears */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <Label>Greatest Hope</Label>
                  <p className="mt-1 p-3 bg-green-50 rounded">
                    "{userData?.wizard.hope}"
                  </p>
                </div>
                <div>
                  <Label>Greatest Fear</Label>
                  <p className="mt-1 p-3 bg-red-50 rounded">
                    "{userData?.wizard.fear}"
                  </p>
                </div>
              </div>
              
              {/* Values */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <Label>Current Values</Label>
                  <div className="flex flex-wrap gap-1 mt-1">
                    {userData?.wizard.current_values.map(value => (
                      <Badge key={value}>{value}</Badge>
                    ))}
                  </div>
                </div>
                <div>
                  <Label>Future Values</Label>
                  <div className="flex flex-wrap gap-1 mt-1">
                    {userData?.wizard.future_values.map(value => (
                      <Badge key={value} variant="secondary">{value}</Badge>
                    ))}
                  </div>
                </div>
              </div>
              
              {/* Feelings & Day in Life */}
              <div>
                <Label>How They Want to Feel</Label>
                <p className="mt-1 p-3 bg-blue-50 rounded">
                  "{userData?.wizard.feelings}"
                </p>
              </div>
              
              <div>
                <Label>A Day in Their Future Life</Label>
                <p className="mt-1 p-3 bg-purple-50 rounded whitespace-pre-wrap">
                  "{userData?.wizard.day_in_life}"
                </p>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
        
        {/* Personality Tab */}
        <TabsContent value="personality">
          <Card>
            <CardHeader>
              <CardTitle>Personality Analysis</CardTitle>
              <Badge>
                Confidence: {Math.round(userData?.personality?.confidence.overall * 100)}%
              </Badge>
            </CardHeader>
            <CardContent>
              {/* Big Five Radar Chart */}
              <div className="mb-6">
                <RadarChart
                  data={[
                    { trait: 'Openness', value: userData?.personality?.bigFive.openness },
                    { trait: 'Conscientiousness', value: userData?.personality?.bigFive.conscientiousness },
                    { trait: 'Extraversion', value: userData?.personality?.bigFive.extraversion },
                    { trait: 'Agreeableness', value: userData?.personality?.bigFive.agreeableness },
                    { trait: 'Neuroticism', value: userData?.personality?.bigFive.neuroticism },
                  ]}
                />
              </div>
              
              {/* Detailed Scores */}
              <div className="grid grid-cols-5 gap-4 mb-6">
                {Object.entries(userData?.personality?.bigFive || {}).map(([trait, score]) => (
                  <div key={trait} className="text-center">
                    <Label className="capitalize">{trait}</Label>
                    <div className="text-2xl font-bold mt-1">{score}/10</div>
                    <Progress value={score * 10} className="mt-2" />
                  </div>
                ))}
              </div>
              
              {/* Communication Style */}
              <div className="grid grid-cols-3 gap-4 mb-6">
                <div>
                  <Label>Preferred Style</Label>
                  <Badge className="mt-1">
                    {userData?.personality?.communicationStyle.preferred}
                  </Badge>
                </div>
                <div>
                  <Label>Tone</Label>
                  <Badge className="mt-1">
                    {userData?.personality?.communicationStyle.tone}
                  </Badge>
                </div>
                <div>
                  <Label>Detail Level</Label>
                  <Badge className="mt-1">
                    {userData?.personality?.communicationStyle.detailLevel}
                  </Badge>
                </div>
              </div>
              
              {/* Motivations */}
              <div className="mb-6">
                <Label>Core Motivations</Label>
                <div className="flex flex-wrap gap-2 mt-2">
                  {userData?.personality?.motivations.map(motivation => (
                    <Badge key={motivation} variant="secondary">
                      {motivation}
                    </Badge>
                  ))}
                </div>
              </div>
              
              {/* Growth Areas */}
              <div>
                <Label>Growth Areas</Label>
                <div className="space-y-2 mt-2">
                  {userData?.personality?.growthAreas.map(area => (
                    <div key={area.area} className="p-3 bg-gray-50 rounded">
                      <div className="flex justify-between items-center">
                        <span className="font-medium">{area.area}</span>
                        <span className="text-sm text-gray-500">
                          Current: {area.currentLevel}/10 → Potential: {area.potential}/10
                        </span>
                      </div>
                      <p className="text-sm text-gray-600 mt-1">{area.strategy}</p>
                    </div>
                  ))}
                </div>
              </div>
            </CardContent>
          </Card>
        </TabsContent>
        
        {/* Actions Tab */}
        <TabsContent value="actions">
          <Card>
            <CardHeader>
              <CardTitle>Admin Actions</CardTitle>
            </CardHeader>
            <CardContent className="space-y-4">
              <Button 
                onClick={() => reanalyzePersonality(userId)}
                className="w-full"
              >
                Re-analyze Personality
              </Button>
              <Button 
                variant="outline"
                onClick={() => resetUserProfile(userId)}
                className="w-full"
              >
                Reset Profile
              </Button>
              <Button 
                variant="outline"
                onClick={() => exportUserData(userId)}
                className="w-full"
              >
                Export User Data (JSON)
              </Button>
              <Button 
                variant="destructive"
                onClick={() => deleteUser(userId)}
                className="w-full"
              >
                Delete User (Permanent)
              </Button>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>
    </div>
  )
}
```

### Phase 5: Analytics & Exports (1 hour)

#### 5.1 Analytics Dashboard
**File:** `src/components/admin/AnalyticsDashboard.tsx`

```typescript
const AnalyticsDashboard = () => {
  return (
    <div className="p-6">
      {/* Personality Distribution */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle>Big Five Distribution Across All Users</CardTitle>
        </CardHeader>
        <CardContent>
          <BarChart
            data={personalityDistribution}
            categories={['Openness', 'Conscientiousness', 'Extraversion', 'Agreeableness', 'Neuroticism']}
          />
        </CardContent>
      </Card>
      
      {/* Common Patterns */}
      <div className="grid grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle>Most Common Hopes</CardTitle>
          </CardHeader>
          <CardContent>
            <WordCloud data={commonHopes} />
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader>
            <CardTitle>Most Common Fears</CardTitle>
          </CardHeader>
          <CardContent>
            <WordCloud data={commonFears} />
          </CardContent>
        </Card>
      </div>
    </div>
  )
}
```

## Database Requirements

### New Columns/Tables Needed
```sql
-- Add admin role to users
ALTER TABLE auth.users 
ADD COLUMN role TEXT DEFAULT 'user';

-- Create admin_audit_log table
CREATE TABLE admin_audit_log (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_id UUID REFERENCES auth.users(id),
  action TEXT NOT NULL,
  target_user_id UUID,
  details JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Index for performance
CREATE INDEX idx_admin_audit_admin_id ON admin_audit_log(admin_id);
CREATE INDEX idx_admin_audit_created_at ON admin_audit_log(created_at DESC);
```

## Security Considerations

### Access Control
- Role-based authentication (superadmin only)
- Audit logging for all admin actions
- Rate limiting on data exports
- Encrypted data transmission

### Privacy
- No PII in URLs
- Secure session management
- Data masking options
- GDPR compliance for exports

## Testing Plan

### Unit Tests
- Admin authentication middleware
- Data aggregation functions
- Export formatters
- Search and filter logic

### Integration Tests
- Full user detail loading
- Export functionality
- Real-time updates
- Performance with large datasets

## Definition of Done

### Core Features
- [ ] Admin authentication working
- [ ] Dashboard overview with stats
- [ ] User list with personality scores
- [ ] Individual user detail views
- [ ] Wizard response display
- [ ] Personality analysis visualization

### Data Management
- [ ] CSV export functionality
- [ ] JSON export functionality
- [ ] Search and filter working
- [ ] Sort functionality implemented

### Security
- [ ] Role-based access control
- [ ] Audit logging enabled
- [ ] Secure data transmission
- [ ] Session management

### Quality
- [ ] Mobile responsive design
- [ ] Loading states implemented
- [ ] Error handling complete
- [ ] Performance optimized (<2s load)

## Dependencies
- Plan 04 (AI Personality Analysis) must be complete
- Supabase admin role configuration
- Data visualization library (recharts recommended)

## Estimated Timeline
- **Phase 1:** Admin Auth (1 hour)
- **Phase 2:** Dashboard Overview (2 hours)
- **Phase 3:** User List (2 hours)
- **Phase 4:** User Details (2 hours)
- **Phase 5:** Analytics & Exports (1 hour)
- **Total:** 8 hours (1 day)

## Notes
- Consider adding real-time updates using Supabase subscriptions
- May want to add email notifications for significant events
- Could expand to include A/B testing capabilities
- Future enhancement: ML insights on user patterns

**Created:** 2025-01-28  
**Author:** System Architecture Team